// Generated by CoffeeScript 1.3.3
(function() {
  var $cached, MOCK_PRODUCT, SCREEN_WIDTH, cacheSelectors, deviceready, displayError, displayProduct, fetchProduct, gotoScreen, scan, screenIndex, search;

  SCREEN_WIDTH = 320;

  MOCK_PRODUCT = {
    name: "Elegant Aqua Lackfärg Matt 10",
    description: "Lackfärg av högsta kvalitet för alla slags möbler och snickerier inomhus. Färgen är lätt att måla med och ger vacker yta.",
    image: "http://www.bauhaus.se/media/catalog/product/cache/1/image/265x/9df78eab33525d08d6e5fb8d27136e95/5/3/5366810S.jpg",
    url: "http://www.bauhaus.se/elegant-aqua-lackfarg-matt-10.html"
  };

  $cached = {};

  screenIndex = 1;

  window.testProduct = function() {
    cacheSelectors();
    return displayProduct(MOCK_PRODUCT);
  };

  cacheSelectors = function() {
    return $cached = {
      body: $("body"),
      app: $(".app"),
      home: {
        $: $("#home"),
        scan: $(".scan"),
        search: $(".search")
      },
      product: {
        $: $("#product")
      },
      templates: {
        product: $("#product-template")
      }
    };
  };

  deviceready = function() {
    cacheSelectors();
    $cached.home.scan.on("click", function() {
      $cached.home.scan.addClass("touch");
      return setTimeout(scan, 100);
    });
    $cached.home.search.on("click", function() {
      $cached.home.search.addClass("touch");
      return setTimeout(search, 100);
    });
    return $(document).on("backbutton", function(e) {
      e.preventDefault();
      if (screenIndex === 1) {
        return navigator.app.exitApp();
      } else {
        return gotoScreen({
          index: screenIndex - 1
        });
      }
    });
  };

  scan = function() {
    return window.plugins.barcodeScanner.scan((function(_arg) {
      var cancelled, format, text;
      cancelled = _arg.cancelled, text = _arg.text, format = _arg.format;
      $cached.home.scan.removeClass("touch");
      if (cancelled) {
        return;
      }
      return fetchProduct({
        code: text,
        success: displayProduct,
        error: displayError
      });
    }), function(error) {
      return alert("Skanning misslyckades: " + error, function() {});
    });
  };

  search = function() {
    var searchWord;
    searchWord = prompt("Ange sökord");
    $cached.home.search.removeClass("touch");
    if (!searchWord) {
      return;
    }
    return fetchProduct({
      name: searchWord,
      success: displayProduct,
      error: displayError
    });
  };

  fetchProduct = function(_arg) {
    var code, error, name, success, _success;
    name = _arg.name, code = _arg.code, error = _arg.error, success = _arg.success;
    _success = true;
    return _.defer(function() {
      if (_success) {
        return typeof success === "function" ? success(MOCK_PRODUCT) : void 0;
      } else {
        return typeof error === "function" ? error("Produkten hittades inte") : void 0;
      }
    });
  };

  displayProduct = function(product) {
    var template;
    gotoScreen({
      id: "product"
    });
    template = _.template($cached.templates.product.html());
    return $cached.product.$.html(template(product));
  };

  displayError = function(error) {
    return alert(error);
  };

  gotoScreen = function(_arg) {
    var $screen, id, index;
    index = _arg.index, id = _arg.id;
    if (id) {
      $screen = $("#" + id);
      index = $screen.data("index");
    } else if (index) {
      $screen = $("section[data-index=" + index + "]");
    }
    screenIndex = index;
    return $cached.app.transition({
      x: -(index - 1) * SCREEN_WIDTH
    }, 500);
  };

  window.app = {
    initialize: function() {
      return $(document).on("deviceready", deviceready);
    }
  };

}).call(this);
